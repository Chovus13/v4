<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haos Bot</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #2c2c2c;
            padding: 10px 20px;
            border-bottom: 1px solid #444;
        }
        #bot-name {
            font-size: 1.5em;
            font-weight: bold;
        }
        #log-container {
            flex-grow: 1;
            margin: 0 20px;
            max-height: 40px;
            overflow-y: auto;
            font-size: 0.9em;
            color: #a0a0a0;
        }
        #latency {
            font-size: 1em;
            color: #00ff00;
        }
        #controls {
            margin: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            padding: 10px 20px;
            background-color: #4a4a4a;
            color: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #5a5a5a;
        }
        button:disabled {
            background-color: #333;
            cursor: not-allowed;
        }
        input {
            padding: 8px;
            background-color: #333;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 5px;
        }
        #data-container {
            margin: 20px;
            padding: 20px;
            background-color: #2c2c2c;
            border-radius: 5px;
        }
        .error {
            color: #ff5555;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="bot-name">Haos Bot</div>
        <div id="log-container"></div>
        <div id="latency">Latency: N/A</div>
    </div>

    <div id="controls">
        <button id="start-btn" onclick="startBot()">Start Bot</button>
        <button id="stop-btn" onclick="stopBot()" disabled>Stop Bot</button>
        <button id="rokada-btn" onclick="toggleRokada()">Toggle Rokada</button>
        <label for="leverage">Leverage:</label>
        <input type="number" id="leverage" value="10" min="1" max="100">
        <label for="amount">Amount (ETH):</label>
        <input type="number" id="amount" value="0.06" min="0.01" step="0.01">
        <span id="error-message" class="error"></span>
    </div>

    <div id="data-container">
        <h2>Bot Data</h2>
        <p>Price: <span id="price">N/A</span></p>
        <p>Support: <span id="support">N/A</span></p>
        <p>Resistance: <span id="resistance">N/A</span></p>
        <p>Trend: <span id="trend">N/A</span></p>
        <p>Balance: <span id="balance">N/A</span> <span id="balance-currency"></span></p>
        <p>Extra Balances: BTC: <span id="extra-btc">N/A</span>, USDT: <span id="extra-usdt">N/A</span></p>
        <p>Rokada Status: <span id="rokada-status">N/A</span></p>
        <p>Active Trades: <span id="active-trades">N/A</span></p>
        <p>Signals: <span id="signals">N/A</span></p>
    </div>

    <script>
        let ws = null;
        let botRunning = false;
        let logs = [];

        function connectWebSocket() {
            ws = new WebSocket('ws://' + window.location.host + '/ws');
            ws.onopen = () => console.log('WebSocket connected');
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'data') {
                    document.getElementById('price').innerText = data.price || 'N/A';
                    document.getElementById('support').innerText = data.support || 'N/A';
                    document.getElementById('resistance').innerText = data.resistance || 'N/A';
                    document.getElementById('trend').innerText = data.trend || 'N/A';
                    document.getElementById('balance').innerText = data.balance || 'N/A';
                    document.getElementById('balance-currency').innerText = data.balance_currency || '';
                    document.getElementById('extra-btc').innerText = data.extra_balances?.BTC || 'N/A';
                    document.getElementById('extra-usdt').innerText = data.extra_balances?.USDT || 'N/A';
                    document.getElementById('rokada-status').innerText = data.rokada_status || 'N/A';
                    document.getElementById('active-trades').innerText = JSON.stringify(data.active_trades) || 'N/A';
                    document.getElementById('signals').innerText = JSON.stringify(data.signals) || 'N/A';
                    document.getElementById('latency').innerText = `Latency: ${data.latency || 'N/A'} ms`;
                } else if (data.type === 'log') {
                    logs.push(data.message);
                    if (logs.length > 5) logs.shift();
                    document.getElementById('log-container').innerHTML = logs.join('<br>');
                }
            };
            ws.onclose = () => setTimeout(connectWebSocket, 5000);
        }

        async function startBot() {
            if (botRunning) return;
            const leverage = document.getElementById('leverage').value;
            const amount = document.getElementById('amount').value;
            const errorMessage = document.getElementById('error-message');
            errorMessage.innerText = '';

            const response = await fetch('/start_bot', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ leverage: parseInt(leverage), amount: parseFloat(amount) })
            });
            const result = await response.json();
            if (result.status === 'success') {
                botRunning = true;
                document.getElementById('start-btn').disabled = true;
                document.getElementById('stop-btn').disabled = false;
                logs.push('Bot started successfully');
                document.getElementById('log-container').innerHTML = logs.join('<br>');
            } else {
                errorMessage.innerText = result.message;
            }
        }

        async function stopBot() {
            if (!botRunning) return;
            const errorMessage = document.getElementById('error-message');
            errorMessage.innerText = '';

            const response = await fetch('/stop_bot', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();
            if (result.status === 'success') {
                botRunning = false;
                document.getElementById('start-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
                logs.push('Bot stopped successfully');
                document.getElementById('log-container').innerHTML = logs.join('<br>');
            } else {
                errorMessage.innerText = result.message;
            }
        }

        async function toggleRokada() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.innerText = '';

            const currentStatus = document.getElementById('rokada-status').innerText;
            const response = await fetch('/set_rokada', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: currentStatus === 'off' ? 'on' : 'off' })
            });
            const result = await response.json();
            if (result.status !== 'success') {
                errorMessage.innerText = result.message;
            } else {
                logs.push(`Rokada toggled to ${currentStatus === 'off' ? 'on' : 'off'}`);
                document.getElementById('log-container').innerHTML = logs.join('<br>');
            }
        }

        connectWebSocket();
    </script>
</body>
</html>